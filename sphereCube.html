<html>
<style>
    .scene {
        perspective: 1050px;
        width: 100%;
        height: 100vh;
    }

    .sphere {
        position: relative;
        transform-style: preserve-3d;
    }

    .sphere_ring {
        width: 400px;
        height: 400px;
        border: 1px solid blueviolet;
        position: absolute;
        border-radius: 50%;
        transform-style: preserve-3d;
        transform: rotateY(10deg);
    }

    .sphere_face {
        background: blue;
        position: absolute;
        transform-origin: top;
        border: 2px solid black;
        box-sizing: border-box;
    }

    .cube {
        position: absolute;
        top: 50%;
        right: 50%;
        width: 100px;
        height: 100px;
        transform-style: preserve-3d;
    }

    .cube__face {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
        position: absolute;
        backface-visibility: inherit;
        font-size: 60px;
        color: white;
    }

    .cube__face--1 {
        background: rgba(90, 90, 90, 0.7);
    }

    .cube__face--2 {
        background: rgba(0, 210, 0, 0.7);
    }

    .cube__face--3 {
        background: rgba(210, 0, 0, 0.7);
    }

    .cube__face--4 {
        background: rgba(0, 0, 210, 0.7);
    }

    .cube__face--5 {
        background: rgba(210, 210, 0, 0.7);
    }

    .cube__face--6 {
        background: rgba(210, 0, 210, 0.7);
    }
</style>

<body>
    <div class="scene">
        <div class="sphere">
        </div>
        <div class="cube">
        </div>
    </div>
</body>
<script>
    const sphere = document.querySelector(".sphere");
    const cuboid = document.querySelector(".cube")
    const sphereWidth = 150;
    const sphereHeight = 150;
    const facesNumber = 18;
    const ringsNumber = 10;
    const gravity = 0.1;

    const cubeWidth = 400;
    const cubeHeight = 400;
    const cubeLong = 600;
    let speed = 0;
    let distance = 0;

    init();

    function init(){
        setSphere();
        setCuboid();
        elementMovement(sphere);
        elementMovement(cuboid);
    }

    function setCuboid(){
        for(let index = 0; index < 6; index++){
            const face = document.createElement("div");
            face.classList.add("cube__face");
            face.classList.add(`cube__face--${index+1}`);
            
            if(index === 0){
                face.style.transform = `translateZ(${cubeWidth/2}px)`;
                face.style.width = cubeLong;
                face.style.height = cubeHeight;
            }
            if(index === 1){
                face.style.transform = `rotateY(180deg) translateZ(${cubeWidth/2}px)`;
                face.style.width = cubeLong;
                face.style.height = cubeHeight;
            }
            if(index === 2){
                face.style.transform = `rotateY(90deg) translateZ(-${cubeWidth/2}px)`;
                face.style.width = cubeWidth;
                face.style.height = cubeHeight;
            }
            if(index === 3){
                let sum = cubeLong - cubeWidth;
                face.style.transform = `rotateY(90deg) translateZ(${cubeWidth/2+sum}PX)`;
                face.style.width = cubeWidth;
                face.style.height = cubeHeight;
            }
            if(index === 4){
                let sum = cubeHeight - cubeWidth;
                face.style.width = cubeLong;
                face.style.height = cubeWidth;
                face.style.transform = `rotateX(90deg) translateZ(${cubeWidth/2}px)`;
            }
            if(index === 5){
                let sum = cubeHeight - cubeWidth;
                face.style.width = cubeLong;
                face.style.height = cubeWidth;
                face.style.transform = `rotateX(-90deg) translateZ(${cubeWidth/2 + sum}px)`;
            }
            cuboid.appendChild(face);
        }
    }

    function setSphere() {
        sphere.style.width = sphereWidth;
        sphere.style.height = sphereHeight;
        createRings();
        // requestAnimationFrame(sphereFreeFall);
    }

    function sphereFreeFall() {
        sphere.style.transform = `translate(0, ${distance}px)`;
        // speed += 0.1;
        distance += speed;
        requestAnimationFrame(sphereFreeFall);
    }

    function createRings() {
        for (let index = 0; index < ringsNumber; index++) {
            const ring = document.createElement("div");
            ring.classList.add("sphere_ring");
            ring.classList.add(`sphere_ring--${index}`);
            ring.style.width = `${sphereWidth}px`;
            ring.style.height = `${sphereHeight}px`;
            ring.style.transform = `rotateY(${(180 / ringsNumber) * index}deg)`;
            sphere.appendChild(ring);
            calculateFaces(90, ring);
        }
    }

    function calculateFaces(yDegrees, sphereRing) {
        const angle = 360 / facesNumber; // 22.5° por div
        for (let index = 0; index < facesNumber; index++) {
            // Convertir el ángulo a radianes: angle * index * π / 180
            const theta = angle * index * Math.PI / 180;

            // Calcular coordenadas: x = centro + r * cos(θ), y = centro - r * sin(θ)
            const rightPosition = sphereWidth / 2 + (Math.cos(theta) * sphereWidth / 2);
            const bottomPosition = sphereHeight / 2 - (Math.sin(theta) * sphereHeight / 2);

            // Calcular ángulo intermedio para la rotación (en grados)
            const rotationAngle = 360 + (angle / 2) - (angle * index);

            generateFace(rightPosition, bottomPosition, rotationAngle, yDegrees, sphereRing);
        }
    }

    function generateFace(rightPosition, bottomPosition, rotationAngle, yDegrees, sphereRing) {
        const face = document.createElement("div");
        face.classList.add("sphere_face");

        // Ajustar left y top, restando 0.5px para centrar el div de 1px de ancho
        face.style.height = Math.PI * sphereHeight / facesNumber; https://www.w3schools.com/jsref/default.asp
        face.style.width = Math.PI * sphereWidth / facesNumber;
        face.style.left = (rightPosition - 0.5) + "px";
        face.style.top = bottomPosition + "px"; // No ajustamos top porque transform-origin: top

        face.style.transform = `translate(-50%) rotateZ(${rotationAngle}deg) rotateY(90deg)`;

        sphereRing.appendChild(face);
    }


    function elementMovement(element){
        let isMouseDown = false;
        let mousePos = {
            x: 0,
            y: 0,
        }
        let lastMouseX = 0;
        let lastMouseY = 0;
        let sumX = 0;
        let sumY = 0;
        function handleHold() {
            if (isMouseDown) {
                requestAnimationFrame(handleHold); // Continue looping
            }
        }

        document.addEventListener('mousemove', (event) => {
            if (event.buttons === 1) {
                const currentMouseX = event.clientX
                const currentMouseY = event.clientY

                if (currentMouseX > lastMouseX) {
                    sumX += 2;
                } else if (currentMouseX < lastMouseX) {
                    sumX -= 2;
                }

                if (currentMouseY > lastMouseY) {
                    sumY -= 2;
                } else if (currentMouseY < lastMouseY) {
                    sumY += 2;
                }

                lastMouseX = currentMouseX;
                lastMouseY = currentMouseY;
                element.style.transform = `rotateX(${sumY}deg) rotateY(${sumX}deg)`;
            }
        });

        document.addEventListener('mousedown', (event) => {
            mousePos.x = event.screenX;
            mousePos.y = event.screenY;
            isMouseDown = true;
        });

        document.addEventListener('mouseup', () => {
            isMouseDown = false;
        });
    }
</script>

</html>